const A=(s,t,p)=>{let o;const n=t,r={ok:!1,pos:t,value:""};for(o=s.charAt(t);t<p&&o.match(/\d/)||o==="%";)o=s.charAt(++t);return r.ok=!0,r.pos=t,r.value=s.slice(n,t),r},k=(s,t,p)=>{const o={ok:!1,pos:0,width:"",height:""};if(t>=p||s.charAt(t)!=="=")return o;t+=1;const n=s.charAt(t);if(n!=="x"&&!n.match(/\d/))return o;const r=A(s,t,p);if(t=r.pos,s.charAt(t)!=="x")return o;t+=1;const h=A(s,t,p);return t=h.pos,o.width=r.value,o.height=h.value,o.pos=t,o.ok=!0,o},g=(s,t)=>{const p=s.env,o=s.pos,n=s.posMax;if(s.src.charAt(s.pos)!=="!"||s.src.charAt(s.pos+1)!=="[")return!1;const r=s.pos+2,h=s.md.helpers.parseLinkLabel(s,s.pos+1,!1);if(h<0)return!1;let e=h+1,a,f="",u="",m="",d="";if(e<n&&s.src.charAt(e)==="("){for(e+=1;e<n&&(a=s.src.charAt(e),!(a!==" "&&a!=="	"));e++);if(e>=n)return!1;let c;c=s.md.helpers.parseLinkDestination(s.src,e,s.posMax),c.ok&&(f=s.md.normalizeLink(c.str),s.md.validateLink(f)?e=c.pos:f="");const i=e;for(;e<n&&(a=s.src.charAt(e),!(a!==" "&&a!=="	"));e++);if(c=s.md.helpers.parseLinkTitle(s.src,e,s.posMax),e<n&&i!==e&&c.ok)for(u=c.str,e=c.pos;e<n&&(a=s.src.charAt(e),!(a!==" "&&a!=="	"));e++);else u="";if(e-1>=0&&(a=s.src.charAt(e-1),a===" "&&(c=k(s.src,e,s.posMax),c.ok)))for(m=c.width,d=c.height,e=c.pos;e<n&&(a=s.src.charAt(e),!(a!==" "&&a!==`
`));e++);if(e>=n||s.src.charAt(e)!==")")return s.pos=o,!1;e+=1}else{let c="";if(typeof p.references>"u")return!1;if(e<n&&s.src.charAt(e)==="["){const l=e+1;e=s.md.helpers.parseLinkLabel(s,e),e>=0?c=s.src.slice(l,e++):e=h+1}else e=h+1;c||(c=s.src.slice(r,h));const i=p.references[s.md.utils.normalizeReference(c)];if(!i)return s.pos=o,!1;f=i.href,u=i.title||""}if(!t){const c=s.src.slice(r,h),i=[];s.md.inline.parse(c,s.md,s.env,i);const l=s.push("image","img",0);l.attrs=[["src",f],["alt",""]],u&&l.attrs.push(["title",u]),m!==""&&l.attrs.push(["width",m]),d!==""&&l.attrs.push(["height",d]),l.children=i,l.content=c}return s.pos=e,s.posMax=n,!0},x=s=>{s.inline.ruler.before("emphasis","image",g)};export{x as imgSize};
//# sourceMappingURL=index.mjs.map
