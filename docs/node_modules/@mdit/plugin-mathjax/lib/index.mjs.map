{"version":3,"file":"index.mjs","sources":["../src/plugin.ts"],"sourcesContent":["/**\n * Forked from https://github.com/tani/markdown-it-mathjax3/blob/master/index.ts\n */\n\nimport { createRequire } from \"node:module\";\nimport path from \"upath\";\nimport { tex } from \"@mdit/plugin-tex\";\nimport { mathjax as MathJax } from \"mathjax-full/js/mathjax.js\";\nimport { TeX } from \"mathjax-full/js/input/tex.js\";\nimport { CHTML } from \"mathjax-full/js/output/chtml.js\";\nimport { SVG } from \"mathjax-full/js/output/svg.js\";\nimport { liteAdaptor } from \"mathjax-full/js/adaptors/liteAdaptor.js\";\nimport { AssistiveMmlHandler } from \"mathjax-full/js/a11y/assistive-mml.js\";\nimport { RegisterHTMLHandler } from \"mathjax-full/js/handlers/html.js\";\nimport { AllPackages } from \"mathjax-full/js/input/tex/AllPackages.js\";\n\nimport type { PluginWithOptions } from \"markdown-it\";\nimport type { LiteAdaptor } from \"mathjax-full/js/adaptors/liteAdaptor.js\";\nimport type { LiteElement } from \"mathjax-full/js/adaptors/lite/Element.js\";\nimport type { MarkdownItMathjaxOptions } from \"./options.js\";\n\nexport interface DocumentOptions {\n  InputJax: TeX<LiteElement, string, HTMLElement>;\n  OutputJax:\n    | CHTML<LiteElement, string, HTMLElement>\n    | SVG<LiteElement, string, HTMLElement>;\n  enableAssistiveMml: boolean;\n}\n\nexport const getDocumentOptions = (\n  options: MarkdownItMathjaxOptions\n): DocumentOptions => ({\n  InputJax: new TeX<LiteElement, string, HTMLElement>({\n    packages: AllPackages,\n    ...options.tex,\n  }),\n  OutputJax:\n    options.output === \"chtml\"\n      ? new CHTML<LiteElement, string, HTMLElement>({\n          fontURL: path.dirname(\n            createRequire(import.meta.url).resolve(\n              \"mathjax-full/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff\"\n            )\n          ),\n          adaptiveCSS: true,\n          ...options.chtml,\n        })\n      : new SVG<LiteElement, string, HTMLElement>({\n          fontCache: \"none\",\n          ...options.svg,\n        }),\n  enableAssistiveMml: options.a11y !== false,\n});\n\nexport interface MathjaxInstance {\n  adaptor: LiteAdaptor;\n  documentOptions: DocumentOptions;\n}\n\nexport const createMathjaxInstance = (\n  options: MarkdownItMathjaxOptions = {}\n): MathjaxInstance | null => {\n  const documentOptions = getDocumentOptions(options);\n  const adaptor = liteAdaptor();\n\n  const handler = RegisterHTMLHandler(adaptor);\n\n  if (options.a11y !== false) AssistiveMmlHandler(handler);\n\n  return {\n    adaptor,\n    documentOptions,\n  };\n};\n\nexport const generateMathjaxStyle = ({\n  adaptor,\n  documentOptions,\n}: MathjaxInstance): string =>\n  adaptor.innerHTML(\n    documentOptions.OutputJax.styleSheet(\n      // eslint-disable-next-line @typescript-eslint/no-unsafe-argument\n      MathJax.document(\"\", documentOptions)\n    )\n  );\n\nexport const mathjax: PluginWithOptions<MathjaxInstance> = (md, options) => {\n  const { adaptor, documentOptions } = options!;\n\n  md.use(tex, {\n    render: (content, displayMode) => {\n      /* eslint-disable */\n      const mathDocument = MathJax.document(content, documentOptions).convert(\n        content,\n        { display: displayMode }\n      );\n      return adaptor.outerHTML(mathDocument);\n    },\n  });\n};\n"],"names":["getDocumentOptions","options","TeX","AllPackages","CHTML","path","createRequire","SVG","createMathjaxInstance","documentOptions","adaptor","liteAdaptor","handler","RegisterHTMLHandler","AssistiveMmlHandler","generateMathjaxStyle","MathJax","mathjax","md","tex","content","displayMode","mathDocument"],"mappings":"gzBA6BO,MAAMA,EACXC,IACqB,CACrB,SAAU,IAAIC,EAAsC,CAClD,SAAUC,EACV,GAAGF,EAAQ,GACb,CAAC,EACD,UACEA,EAAQ,SAAW,QACf,IAAIG,EAAwC,CAC1C,QAASC,EAAK,QACZC,EAAc,YAAY,GAAG,EAAE,QAC7B,+DACF,CACF,EACA,YAAa,GACb,GAAGL,EAAQ,KACb,CAAC,EACD,IAAIM,EAAsC,CACxC,UAAW,OACX,GAAGN,EAAQ,GACb,CAAC,EACP,mBAAoBA,EAAQ,OAAS,EACvC,GAOaO,EAAwB,CACnCP,EAAoC,CAAA,IACT,CAC3B,MAAMQ,EAAkBT,EAAmBC,CAAO,EAC5CS,EAAUC,EAAY,EAEtBC,EAAUC,EAAoBH,CAAO,EAE3C,OAAIT,EAAQ,OAAS,IAAOa,EAAoBF,CAAO,EAEhD,CACL,QAAAF,EACA,gBAAAD,CACF,CACF,EAEaM,EAAuB,CAAC,CACnC,QAAAL,EACA,gBAAAD,CACF,IACEC,EAAQ,UACND,EAAgB,UAAU,WAExBO,EAAQ,SAAS,GAAIP,CAAe,CACtC,CACF,EAEWQ,EAA8C,CAACC,EAAIjB,IAAY,CAC1E,KAAM,CAAE,QAAAS,EAAS,gBAAAD,CAAgB,EAAIR,EAErCiB,EAAG,IAAIC,EAAK,CACV,OAAQ,CAACC,EAASC,IAAgB,CAEhC,MAAMC,EAAeN,EAAQ,SAASI,EAASX,CAAe,EAAE,QAC9DW,EACA,CAAE,QAASC,CAAY,CACzB,EACA,OAAOX,EAAQ,UAAUY,CAAY,CACvC,CACF,CAAC,CACH"}