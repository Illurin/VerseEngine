{"version":3,"file":"index.js","sources":["../../src/node/locales.ts","../../src/node/utils.ts","../../src/node/convert/utils.ts","../../src/node/convert/convert.ts","../../src/node/prepare.ts","../../src/node/plugins.ts"],"sourcesContent":["import type { BackToTopLocaleConfig } from \"../shared/index.js\";\n\nexport const backToTopLocales: BackToTopLocaleConfig = {\n  \"/en/\": {\n    backToTop: \"Back to top\",\n  },\n\n  \"/zh/\": {\n    backToTop: \"返回顶部\",\n  },\n\n  \"/zh-tw/\": {\n    backToTop: \"返回頂部\",\n  },\n\n  \"/de-at/\": {\n    backToTop: \"Zurück nach oben.\",\n  },\n\n  \"/vi/\": {\n    backToTop: \"Trở lại đầu trang\",\n  },\n\n  \"/uk/\": {\n    backToTop: \"Повернутися до початку\",\n  },\n\n  \"/ru/\": {\n    backToTop: \"Вернуться к началу\",\n  },\n\n  \"/br/\": {\n    backToTop: \"Volta ao topo\",\n  },\n\n  \"/pl/\": {\n    backToTop: \"Wróć na górę\",\n  },\n\n  \"/sk/\": {\n    backToTop: \"Back to top\",\n  },\n\n  \"/fr/\": {\n    backToTop: \"Back to top\",\n  },\n\n  \"/es/\": {\n    backToTop: \"Volver arriba\",\n  },\n\n  \"/ja/\": {\n    backToTop: \"このページのトップへ戻る\",\n  },\n\n  \"/tr/\": {\n    backToTop: \"En başa dön\",\n  },\n\n  \"/ko/\": {\n    backToTop: \"맨 위로\",\n  },\n};\n","import { ensureEndingSlash } from \"@vuepress/shared\";\nimport { getDirname, path } from \"@vuepress/utils\";\nimport { Logger } from \"vuepress-shared/node\";\nexport const logger = new Logger(\"vuepress-plugin-components\");\n\nconst __dirname = getDirname(import.meta.url);\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, \"../client\")\n);\n\nexport const getIconPrefix = (assets = \"\"): string => {\n  if (\n    assets === \"fontawesome\" ||\n    assets.match(/^(?:https:)?\\/\\/kit\\.fontawesome\\.com\\//)\n  )\n    return \"fas fa-\";\n  if (\n    assets === \"iconfont\" ||\n    assets.match(/^(?:https:)?\\/\\/at\\.alicdn\\.com\\/t\\//)\n  )\n    return \"iconfont icon-\";\n\n  return \"\";\n};\n","import { colors } from \"@vuepress/utils\";\nimport { logger } from \"../utils.js\";\n\nexport interface DeprecatedLoggerOptions {\n  options: Record<string, unknown>;\n  deprecatedOption: string;\n  newOption: string;\n  msg?: string;\n  scope?: string;\n}\n\nexport const deprecatedLogger = ({\n  options,\n  deprecatedOption,\n  newOption,\n  msg = \"\",\n  scope = \"\",\n}: DeprecatedLoggerOptions): void => {\n  if (deprecatedOption in options) {\n    logger.warn(\n      `${colors.magenta(deprecatedOption)} is ${colors.yellow(\"deprecated\")}${\n        scope ? ` in ${scope}` : \"\"\n      }, please use \"${colors.magenta(newOption)}\" instead.${\n        msg ? `\\n${msg}` : \"\"\n      }`\n    );\n\n    if (newOption.includes(\".\")) {\n      const keys = newOption.split(\".\");\n      let temp = options;\n\n      keys.forEach((key, index) => {\n        if (index !== keys.length - 1) {\n          // ensure level exists\n          temp[key] = temp[key] || {};\n\n          temp = temp[key] as Record<string, unknown>;\n        } else temp[key] = options[deprecatedOption];\n      });\n    } else options[newOption] = options[deprecatedOption];\n\n    delete options[deprecatedOption];\n  }\n};\n\nexport const droppedLogger = (\n  options: Record<string, unknown>,\n  droppedOption: string,\n  hint = \"\",\n  newOption = \"\"\n): void => {\n  if (droppedOption in options) {\n    logger.error(\n      `\"${colors.magenta(droppedOption)}\" is ${colors.red(\"removed\")}${\n        newOption\n          ? `, please use ${colors.magenta(newOption)} instead.`\n          : \" and no longer supported\"\n      }${hint ? `\\n${hint}` : \"\"}`\n    );\n\n    if (!newOption) delete options[droppedOption];\n  }\n};\n","import { deprecatedLogger } from \"./utils.js\";\nimport type { ComponentOptions } from \"../options.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: ComponentOptions & Record<string, unknown>\n): void => {\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"iconAssets\",\n    newOption: \"componentOptions.fontIcon.assets\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"iconPrefix\",\n    newOption: \"componentOptions.fontIcon.prefix\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"addThis\",\n    newOption: \"rootComponents.addThis\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"backToTop\",\n    newOption: \"rootComponents.backToTop\",\n  });\n\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"notice\",\n    newOption: \"rootComponents.notice\",\n  });\n  deprecatedLogger({\n    options,\n    deprecatedOption: \"backToTopLocales\",\n    newOption: \"locales.backToTop\",\n  });\n};\n","import { CLIENT_FOLDER, logger } from \"./utils.js\";\n\nimport type { App } from \"@vuepress/core\";\nimport type { AvailableComponent, ComponentOptions } from \"./options.js\";\n\nconst availableComponents: AvailableComponent[] = [\n  \"AudioPlayer\",\n  \"Badge\",\n  \"BiliBili\",\n  \"CodePen\",\n  \"FontIcon\",\n  \"PDF\",\n  \"StackBlitz\",\n  \"VideoPlayer\",\n  \"YouTube\",\n];\n\nconst getIconLink = (\n  iconLink?: string\n): { type: string; content: string } | null => {\n  if (!iconLink) return null;\n\n  if (iconLink === \"fontawesome\")\n    return {\n      type: \"script\",\n      content: \"https://kit.fontawesome.com/ca37c296c5.js\",\n    };\n\n  if (iconLink === \"iconfont\")\n    return {\n      type: \"style\",\n      content: `@import url(\"//at.alicdn.com/t/font_2410206_a0xb9hku9iu.css\");`,\n    };\n\n  const actualLink = iconLink.match(/^(?:https?:)?\\/\\//g)\n    ? iconLink\n    : `//${iconLink}`;\n\n  if (actualLink.endsWith(\".css\"))\n    return {\n      type: \"style\",\n      content: `@import url(\"${iconLink}\");`,\n    };\n\n  if (actualLink.endsWith(\".js\"))\n    return {\n      type: \"script\",\n      content: iconLink,\n    };\n\n  logger.error(`Can not recognize icon link: \"${iconLink}\"`);\n\n  return null;\n};\n\nexport const prepareConfigFile = (\n  app: App,\n  {\n    components = [],\n    componentOptions = {},\n    rootComponents = {},\n  }: ComponentOptions\n): Promise<string> => {\n  let configImport = \"\";\n  let enhance = \"\";\n  let setup = \"\";\n  let configRootComponents = \"\";\n  let shouldImportH = false;\n  let shouldImportUseScriptTag = false;\n  let shouldImportUseStyleTag = false;\n\n  components.forEach((item) => {\n    if (availableComponents.includes(item)) {\n      configImport += `\\\nimport ${item} from \"${CLIENT_FOLDER}components/${item}.js\";\n`;\n      enhance += `\\\napp.component(\"${item}\", ${item});\n`;\n    }\n\n    if (item === \"FontIcon\") {\n      const result = getIconLink(componentOptions.fontIcon?.assets);\n\n      if (result) {\n        const { type, content } = result;\n\n        if (type === \"script\") {\n          shouldImportUseScriptTag = true;\n          setup += `\\\nuseScriptTag(\\`${content}\\`);\n`;\n        } else {\n          shouldImportUseStyleTag = true;\n          setup += `\\\nuseStyleTag(\\`${content}\\`, { id: \"icon-assets\" });\n`;\n        }\n      }\n    }\n  });\n\n  if (typeof rootComponents.addThis === \"string\") {\n    shouldImportUseScriptTag = true;\n    setup += `\\\nuseScriptTag(\\`//s7.addthis.com/js/300/addthis_widget.js#pubid=${rootComponents.addThis}\\`);\n`;\n  }\n\n  if (rootComponents.backToTop) {\n    shouldImportH = true;\n    configImport += `\\\nimport BackToTop from \"${CLIENT_FOLDER}components/BackToTop.js\";\n`;\n    configRootComponents += `\\\n() => h(BackToTop, { threshold: ${\n      typeof rootComponents.backToTop === \"number\"\n        ? rootComponents.backToTop\n        : 300\n    } }),\n`;\n  }\n\n  if (typeof rootComponents.notice === \"object\") {\n    shouldImportH = true;\n    configImport += `\\\nimport Notice from \"${CLIENT_FOLDER}components/Notice.js\";\n`;\n\n    configRootComponents += `\\\n() => h(Notice, ${JSON.stringify(rootComponents.notice)}),\n`;\n  }\n\n  return app.writeTemp(\n    `components/config.js`,\n    `\\\nimport { defineClientConfig } from \"@vuepress/client\";\n${\n  shouldImportH\n    ? `\\\nimport { h } from \"vue\";\n`\n    : \"\"\n}\n${\n  shouldImportUseScriptTag\n    ? `\\\nimport { useScriptTag } from \"${CLIENT_FOLDER}vueuse.js\";\n`\n    : \"\"\n}\\\n${\n  shouldImportUseStyleTag\n    ? `\\\nimport { useStyleTag } from \"${CLIENT_FOLDER}vueuse.js\";\n`\n    : \"\"\n}\\\n${configImport}\n\nimport \"${CLIENT_FOLDER}styles/sr-only.scss\";\n\nexport default defineClientConfig({\n  enhance: ({ app }) => {\n${enhance\n  .split(\"\\n\")\n  .map((item) => `    ${item}`)\n  .join(\"\\n\")}\n  },\n  setup: () => {\n${setup\n  .split(\"\\n\")\n  .map((item) => `    ${item}`)\n  .join(\"\\n\")}\n  },\n  rootComponents: [\n${configRootComponents\n  .split(\"\\n\")\n  .map((item) => `    ${item}`)\n  .join(\"\\n\")}\n  ],\n});\n`\n  );\n};\n","import { useSassPalettePlugin } from \"vuepress-plugin-sass-palette\";\nimport { getLocales, mergeViteConfig } from \"vuepress-shared/node\";\n\nimport { convertOptions } from \"./convert/index.js\";\nimport { backToTopLocales } from \"./locales.js\";\nimport { prepareConfigFile } from \"./prepare.js\";\nimport { getIconPrefix, logger } from \"./utils.js\";\n\nimport type { PluginFunction } from \"@vuepress/core\";\nimport type { ViteBundlerOptions } from \"@vuepress/bundler-vite\";\nimport type { RollupWarning } from \"rollup\";\nimport type { ComponentOptions } from \"./options.js\";\n\nexport const componentsPlugin =\n  (options: ComponentOptions, legacy = false): PluginFunction =>\n  (app) => {\n    // TODO: Remove this in v2 stable\n    if (legacy)\n      convertOptions(options as ComponentOptions & Record<string, unknown>);\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    useSassPalettePlugin(app, { id: \"hope\" });\n\n    return {\n      name: \"vuepress-plugin-components\",\n\n      define: (): Record<string, unknown> => {\n        const { assets, prefix } = options.componentOptions?.fontIcon || {};\n\n        return {\n          BACK_TO_TOP_LOCALES: getLocales({\n            app,\n            name: \"backToTop\",\n            default: backToTopLocales,\n            config: options.locales?.backToTop,\n          }),\n          ICON_PREFIX:\n            typeof prefix === \"string\" ? prefix : getIconPrefix(assets),\n          PDFJS_URL: options.componentOptions?.pdf?.pdfjs || null,\n        };\n      },\n\n      extendsBundlerOptions: (config: unknown, app): void => {\n        const { bundler } = app.options;\n\n        if (bundler.name.endsWith(\"vite\")) {\n          const bundlerConfig = <ViteBundlerOptions>config;\n\n          bundlerConfig.viteOptions = mergeViteConfig(\n            bundlerConfig.viteOptions || {},\n            {\n              build: {\n                rollupOptions: {\n                  onwarn(\n                    warning: RollupWarning,\n                    warn: (warning: RollupWarning) => void\n                  ) {\n                    if (\n                      warning.message.includes(\n                        'is imported from external module \"@vueuse/core\" but never used in '\n                      )\n                    )\n                      return;\n\n                    warn(warning);\n                  },\n                },\n              },\n            }\n          );\n        }\n      },\n\n      clientConfigFile: (app) => prepareConfigFile(app, options),\n    };\n  };\n"],"names":["backToTopLocales","logger","Logger","__dirname","getDirname","CLIENT_FOLDER","ensureEndingSlash","path","getIconPrefix","assets","deprecatedLogger","options","deprecatedOption","newOption","msg","scope","colors","keys","temp","key","index","convertOptions","availableComponents","getIconLink","iconLink","actualLink","prepareConfigFile","app","components","componentOptions","rootComponents","configImport","enhance","setup","configRootComponents","shouldImportH","shouldImportUseScriptTag","shouldImportUseStyleTag","item","_a","result","type","content","componentsPlugin","legacy","useSassPalettePlugin","_b","_c","_d","prefix","getLocales","config","bundler","bundlerConfig","mergeViteConfig","warning","warn"],"mappings":"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"}