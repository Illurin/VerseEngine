{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/compact/utils.ts","../../src/node/compact/convert.ts","../../src/node/options.ts","../../src/node/injectHead.ts","../../src/node/atom/index.ts","../../src/node/json/index.ts","../../src/node/rss/index.ts","../../src/node/feed.ts","../../src/node/page.ts","../../src/node/generator.ts","../../src/node/plugin.ts"],"sourcesContent":["import {\n  isLinkHttp,\n  removeEndingSlash,\n  removeLeadingSlash,\n} from \"@vuepress/shared\";\nimport { Logger } from \"vuepress-shared/node\";\n\nexport const FEED_GENERATOR = \"vuepress-plugin-feed2\";\n\nexport const logger = new Logger(FEED_GENERATOR);\n\nexport const compareDate = (\n  dateA: Date | string | undefined,\n  dateB: Date | string | undefined\n): number => {\n  if (!dateA || !(dateA instanceof Date)) return 1;\n  if (!dateB || !(dateB instanceof Date)) return -1;\n\n  return dateB.getTime() - dateA.getTime();\n};\n\nexport const resolveUrl = (hostname: string, base = \"\", path = \"\"): string =>\n  `${\n    isLinkHttp(hostname)\n      ? removeEndingSlash(hostname)\n      : `https://${removeEndingSlash(hostname)}`\n  }${base}${removeLeadingSlash(path)}`;\n\nexport const getImageMineType = (ext = \"\"): string =>\n  `image/${\n    ext === \"jpg\"\n      ? \"jpeg\"\n      : ext === \"svg\"\n      ? \"svg+xml\"\n      : ext === \"jpeg\" ||\n        ext === \"png\" ||\n        ext === \"bmp\" ||\n        ext === \"gif\" ||\n        ext === \"webp\"\n      ? ext\n      : \"\"\n  }`;\n","import { colors } from \"@vuepress/utils\";\nimport { logger } from \"../utils.js\";\n\nexport interface DeprecatedLoggerOptions {\n  options: Record<string, unknown>;\n  deprecatedOption: string;\n  newOption: string;\n  msg?: string;\n  scope?: string;\n}\n\nexport const deprecatedLogger = ({\n  options,\n  deprecatedOption,\n  newOption,\n  msg = \"\",\n  scope = \"\",\n}: DeprecatedLoggerOptions): void => {\n  if (deprecatedOption in options) {\n    logger.warn(\n      `${colors.magenta(deprecatedOption)} is ${colors.yellow(\"deprecated\")}${\n        scope ? ` in ${scope}` : \"\"\n      }, please use \"${colors.magenta(newOption)}\" instead.${\n        msg ? `\\n${msg}` : \"\"\n      }`\n    );\n\n    if (newOption.includes(\".\")) {\n      const keys = newOption.split(\".\");\n      let temp = options;\n\n      keys.forEach((key, index) => {\n        if (index !== keys.length - 1) {\n          // ensure level exists\n          temp[key] = temp[key] || {};\n\n          temp = temp[key] as Record<string, unknown>;\n        } else temp[key] = options[deprecatedOption];\n      });\n    } else options[newOption] = options[deprecatedOption];\n\n    delete options[deprecatedOption];\n  }\n};\n\nexport const droppedLogger = (\n  options: Record<string, unknown>,\n  droppedOption: string,\n  hint = \"\",\n  newOption = \"\"\n): void => {\n  if (droppedOption in options) {\n    logger.error(\n      `\"${colors.magenta(droppedOption)}\" is ${colors.red(\"removed\")}${\n        newOption\n          ? `, please use ${colors.magenta(newOption)} instead.`\n          : \" and no longer supported\"\n      }${hint ? `\\n${hint}` : \"\"}`\n    );\n\n    if (!newOption) delete options[droppedOption];\n  }\n};\n","import { droppedLogger } from \"./utils.js\";\n\nimport type { FeedOptions } from \"../typings/index.js\";\n\n/** @deprecated */\nexport const convertOptions = (\n  options: FeedOptions & Record<string, unknown>\n): void => {\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.atom = options[\"output\"]?.atom?.enable ?? true;\n\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.json = options[\"output\"]?.json?.enable ?? true;\n\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.rss = options[\"output\"]?.rss?.enable ?? true;\n\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.atomOutputFilename = options[\"output\"]?.atom?.path ?? \"atom.xml\";\n\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.jsonOutputFilename = options[\"output\"]?.json?.path ?? \"feed.json\";\n\n  // @ts-ignore\n  // eslint-disable-next-line\n  options.jsonOutputFilename = options[\"output\"]?.rss?.path ?? \"rss.xml\";\n\n  droppedLogger(options, \"output\");\n};\n","import {\n  isLinkHttp,\n  removeEndingSlash,\n  removeLeadingSlash,\n} from \"@vuepress/shared\";\nimport { deepMerge } from \"vuepress-shared/node\";\n\nimport { compareDate, resolveUrl } from \"./utils.js\";\n\nimport type { App, Page } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport type {\n  BaseFeedOptions,\n  FeedChannelOption,\n  FeedLinks,\n  FeedOptions,\n} from \"./typings/index.js\";\n\nexport type ResolvedFeedOptions = BaseFeedOptions & { hostname: string };\n\nexport type ResolvedFeedOptionsMap = Record<string, ResolvedFeedOptions>;\n\nexport const ensureHostName = (options: Partial<FeedOptions>): boolean => {\n  // make sure hostname do not end with `/`\n  if (options.hostname) {\n    options.hostname = isLinkHttp(options.hostname)\n      ? removeEndingSlash(options.hostname)\n      : `https://${removeEndingSlash(options.hostname)}`;\n\n    return true;\n  }\n\n  return false;\n};\n\nexport const checkOutput = (options: Partial<FeedOptions>): boolean =>\n  // some locales request output\n  (options.locales &&\n    Object.entries(options.locales).some(\n      ([, { atom, json, rss }]) => atom || json || rss\n    )) ||\n  // root option requests output\n  Boolean(options.atom || options.json || options.rss);\n\nexport const getFeedOptions = (\n  { siteData }: App,\n  options: FeedOptions\n): ResolvedFeedOptionsMap =>\n  Object.fromEntries(\n    Object.keys({\n      // root locale must exists\n      // eslint-disable-next-line @typescript-eslint/naming-convention\n      \"/\": {},\n      ...siteData.locales,\n    }).map((localePath) => [\n      localePath,\n      <ResolvedFeedOptions>{\n        // default values\n        filter: ({ frontmatter, filePathRelative }: Page): boolean =>\n          !(\n            frontmatter[\"home\"] ||\n            !filePathRelative ||\n            frontmatter[\"article\"] === false ||\n            frontmatter[\"feed\"] === false\n          ),\n        sorter: (\n          pageA: Page<{ git?: GitData }, Record<string, never>>,\n          pageB: Page<{ git?: GitData }, Record<string, never>>\n        ): number =>\n          compareDate(\n            pageA.data.git?.createdTime\n              ? new Date(pageA.data.git?.createdTime)\n              : pageA.frontmatter.date,\n            pageB.data.git?.createdTime\n              ? new Date(pageB.data.git?.createdTime)\n              : pageB.frontmatter.date\n          ),\n        ...options,\n        ...options.locales?.[localePath],\n\n        // make sure hostname is not been override\n        hostname: options.hostname,\n      },\n    ])\n  );\n\nexport const getFeedChannelOption = (\n  app: App,\n  options: FeedOptions,\n  localePath = \"\"\n): FeedChannelOption => {\n  const { base } = app.options;\n  const { title, description, lang, locales } = app.siteData;\n  const { hostname, icon, image } = options;\n  const author = options.channel?.author?.name;\n\n  const defaultChannelOption: FeedChannelOption = {\n    title: locales[localePath]?.title || title || locales[\"/\"]?.title || \"\",\n    link: resolveUrl(hostname, base, localePath),\n    description:\n      locales[localePath]?.description ||\n      description ||\n      locales[\"/\"]?.description ||\n      \"\",\n    language: locales[localePath]?.lang || lang,\n    copyright: author ? `Copyright by ${author}` : \"\",\n    pubDate: new Date(),\n    lastUpdated: new Date(),\n    ...(icon ? { icon } : {}),\n    ...(image ? { image } : {}),\n    ...(author ? { author: { name: author } } : {}),\n  };\n\n  return deepMerge(defaultChannelOption, options.channel || {});\n};\n\nexport const getFilename = (\n  options: ResolvedFeedOptions,\n  prefix = \"/\"\n): {\n  atomOutputFilename: string;\n  jsonOutputFilename: string;\n  rssOutputFilename: string;\n} => ({\n  atomOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.atomOutputFilename || \"atom.xml\"\n  }`,\n  jsonOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.jsonOutputFilename || \"feed.json\"\n  }`,\n  rssOutputFilename: `${removeLeadingSlash(prefix)}${\n    options.rssOutputFilename || \"rss.xml\"\n  }`,\n});\n\nexport const getFeedLinks = (\n  { options: { base } }: App,\n  options: FeedOptions\n): FeedLinks => {\n  const { hostname } = options;\n  const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n    getFilename(options);\n\n  return {\n    atom: resolveUrl(hostname, base, atomOutputFilename),\n    json: resolveUrl(hostname, base, jsonOutputFilename),\n    rss: resolveUrl(hostname, base, rssOutputFilename),\n  };\n};\n","import { getFilename } from \"./options.js\";\nimport { resolveUrl } from \"./utils.js\";\n\nimport type { App, HeadConfig } from \"@vuepress/core\";\nimport type { ResolvedFeedOptionsMap } from \"./options.js\";\n\nexport const injectLinksToHead = (\n  app: App,\n  options: ResolvedFeedOptionsMap\n): void => {\n  const { base } = app.options;\n  const { siteData } = app;\n  const localePaths = Object.keys(options);\n\n  // there is only one language, so we append it to siteData\n  if (localePaths.length === 1) {\n    const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n      getFilename(options[\"/\"]);\n    const { atom, json, rss, hostname } = options[\"/\"];\n\n    const getHeadItem = (\n      name: string,\n      fileName: string,\n      type: string\n    ): HeadConfig => {\n      return [\n        \"link\",\n        {\n          rel: \"alternate\",\n          type,\n          href: resolveUrl(hostname, base, fileName),\n          title: `${\n            siteData.title || siteData.locales[\"/\"]?.title || \"\"\n          } ${name} Feed`,\n        },\n      ];\n    };\n\n    // ensure head exists\n    if (!siteData.head) siteData.head = [];\n\n    // add atom link\n    if (atom)\n      siteData.head.push(\n        getHeadItem(\"Atom\", atomOutputFilename, \"application/atom+xml\")\n      );\n\n    // add json link\n    if (json)\n      siteData.head.push(\n        getHeadItem(\"JSON\", jsonOutputFilename, \"application/json\")\n      );\n\n    // add rss link\n    if (rss)\n      siteData.head.push(\n        getHeadItem(\"RSS\", rssOutputFilename, \"application/rss+xml\")\n      );\n  }\n  // there are multiple languages, so we should append to page\n  else\n    app.pages.forEach((page) => {\n      const { pathLocale } = page;\n      const localeOptions = options[pathLocale]!;\n\n      if (localePaths.includes(pathLocale)) {\n        const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n          getFilename(localeOptions, pathLocale);\n\n        const getHeadItem = (\n          name: string,\n          fileName: string,\n          type: string\n        ): HeadConfig => {\n          return [\n            \"link\",\n            {\n              rel: \"alternate\",\n              type,\n              href: resolveUrl(localeOptions.hostname, base, fileName),\n              title: `${\n                siteData.locales[pathLocale]?.title ||\n                siteData.title ||\n                siteData.locales[\"/\"]?.title ||\n                \"\"\n              } ${name} Feed`,\n            },\n          ];\n        };\n\n        // ensure head exists\n        if (!page.frontmatter.head) page.frontmatter.head = [];\n\n        // add atom link\n        if (localeOptions.atom)\n          page.frontmatter.head.push(\n            getHeadItem(\"Atom\", atomOutputFilename, \"application/atom+xml\")\n          );\n\n        // add json link\n        if (localeOptions.json)\n          page.frontmatter.head.push(\n            getHeadItem(\"JSON\", jsonOutputFilename, \"application/json\")\n          );\n\n        // add rss link\n        if (localeOptions.rss)\n          page.frontmatter.head.push(\n            getHeadItem(\"RSS\", rssOutputFilename, \"application/rss+xml\")\n          );\n      }\n    });\n};\n","import { encodeCDATA, encodeXML } from \"vuepress-shared/node\";\nimport { js2xml } from \"xml-js\";\nimport { FEED_GENERATOR } from \"../utils.js\";\n\nimport type { Feed } from \"../feed.js\";\nimport type { FeedAuthor, FeedCategory } from \"../typings/index.js\";\nimport type {\n  AtomAuthor,\n  AtomCategory,\n  AtomContent,\n  AtomEntry,\n} from \"./typings.js\";\n\nconst getAuthor = (author: FeedAuthor): AtomAuthor => {\n  const { name = \"Unknown\", email, url } = author;\n\n  return {\n    name,\n    ...(email ? { email } : {}),\n    ...(url ? { uri: encodeXML(url) } : {}),\n  };\n};\n\nconst genCategory = (category: FeedCategory): AtomCategory => {\n  const { name, scheme = \"\" } = category;\n\n  return {\n    _attributes: {\n      term: name,\n      scheme,\n    },\n  };\n};\n\n/**\n * Returns an Atom 1.0 feed\n *\n * @see http://www.atomenabled.org/developers/syndication/\n */\nexport const renderAtom = (feed: Feed): string => {\n  const { channel, links } = feed.options;\n\n  const content: AtomContent = {\n    _declaration: {\n      _attributes: {\n        version: \"1.0\",\n        encoding: \"utf-8\",\n      },\n    },\n    feed: {\n      _attributes: {\n        xmlns: \"http://www.w3.org/2005/Atom\",\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        ...(channel.language ? { \"xml:lang\": channel.language } : {}),\n      },\n      id: channel.link,\n      title: channel.title,\n\n      ...(channel.description ? { subtitle: channel.description } : {}),\n\n      ...(channel.author ? { author: getAuthor(channel.author) } : {}),\n\n      updated: channel.lastUpdated\n        ? channel.lastUpdated.toISOString()\n        : new Date().toISOString(),\n      generator: FEED_GENERATOR,\n      link: [{ _attributes: { rel: \"self\", href: encodeXML(links.atom) } }],\n    },\n  };\n\n  if (channel.link)\n    content.feed.link.push({\n      _attributes: { rel: \"alternate\", href: encodeXML(channel.link) },\n    });\n\n  if (channel.hub)\n    content.feed.link.push({\n      _attributes: { rel: \"hub\", href: encodeXML(channel.hub) },\n    });\n\n  if (channel.image) content.feed.logo = channel.image;\n\n  if (channel.icon) content.feed.icon = channel.icon;\n\n  if (channel.copyright) content.feed.rights = channel.copyright;\n\n  content.feed.category = Array.from(feed.categories).map((category) => ({\n    _attributes: { term: category },\n  }));\n\n  content.feed.contributor = Array.from(feed.contributors)\n    .filter((contributor) => contributor.name)\n    .map((contributor) => getAuthor(contributor));\n\n  /**\n   * \"entry\" nodes\n   */\n  content.feed.entry = feed.items.map((item) => {\n    // entry: required elements\n    const entry: AtomEntry = {\n      title: { _attributes: { type: \"html\" }, _text: encodeXML(item.title) },\n      id: encodeXML(item.guid || item.link),\n      link: { _attributes: { href: encodeXML(item.link) } },\n      updated: item.lastUpdated.toISOString(),\n    };\n\n    // entry: recommended elements\n    if (item.description) {\n      entry.summary = item.description.startsWith(\"html:\")\n        ? {\n            _attributes: { type: \"html\" },\n            _cdata: encodeCDATA(item.description.substring(5)),\n          }\n        : {\n            _attributes: { type: \"html\" },\n            _text: item.description,\n          };\n    }\n\n    if (item.content)\n      entry.content = {\n        _attributes: { type: \"html\" },\n        _cdata: encodeCDATA(item.content),\n      };\n\n    // author(s)\n    if (item.author)\n      entry.author = item.author\n        .filter((author) => author.name)\n        .map((author) => getAuthor(author));\n\n    if (item.category)\n      // category\n      entry.category = item.category.map((category) => genCategory(category));\n\n    // contributor\n    if (item.contributor)\n      entry.contributor = item.contributor.map((contributor) =>\n        getAuthor(contributor)\n      );\n\n    // published\n    if (item.pubDate) entry.published = item.pubDate.toISOString();\n\n    // rights\n    if (item.copyright) entry.rights = item.copyright;\n\n    return entry;\n  });\n\n  return js2xml(content, {\n    compact: true,\n    ignoreComment: true,\n    spaces: 2,\n  });\n};\n","/* eslint-disable @typescript-eslint/naming-convention */\nimport { stripTags } from \"vuepress-shared/node\";\n\nimport type { Feed } from \"../feed.js\";\nimport type { JSONAuthor, JSONContent, JSONItem } from \"./typings.js\";\nimport type { FeedAuthor } from \"../typings/index.js\";\n\nconst formatAuthor = (author: FeedAuthor): JSONAuthor => ({\n  name: author.name!,\n  ...(author.url ? { url: author.url } : {}),\n  ...(author.avatar ? { avatar: author.avatar } : {}),\n});\n\n/**\n * JSON 1.1 feed\n *\n * @see https://jsonfeed.org/version/1.1\n */\nexport const renderJSON = (feed: Feed): string => {\n  const { channel, links } = feed.options;\n\n  const content: JSONContent = {\n    version: \"https://jsonfeed.org/version/1.1\",\n    title: channel.title,\n    home_page_url: channel.link,\n    feed_url: links.json,\n  };\n\n  if (channel.description) content.description = channel.description;\n\n  if (channel.image) content.icon = channel.image;\n  if (channel.icon) content.favicon = channel.icon;\n\n  if (channel.author?.name) {\n    content.author = {\n      name: channel.author.name,\n      ...(channel.author.url ? { url: channel.author.url } : {}),\n      ...(channel.author.avatar ? { avatar: channel.author.avatar } : {}),\n    };\n  }\n\n  content.items = feed.items.map((item) => {\n    const feedItem: JSONItem = {\n      title: item.title,\n      url: item.link,\n      id: item.guid || item.link,\n      ...(item.description\n        ? {\n            summary: item.description.startsWith(\"html:\")\n              ? stripTags(item.description.substring(5))\n              : item.description,\n          }\n        : {}),\n\n      // json_feed distinguishes between html and text content\n      // but since we only take a single type, we'll assume HTML\n      content_html: item.content,\n    };\n\n    if (item.image) feedItem.image = item.image;\n\n    if (item.pubDate) feedItem.date_published = item.pubDate.toISOString();\n\n    if (item.lastUpdated)\n      feedItem.date_modified = item.lastUpdated.toISOString();\n\n    // author\n    if (Array.isArray(item.author))\n      feedItem.authors = item.author\n        .filter((author) => author.name)\n        .map((author) => formatAuthor(author));\n\n    // tags\n    if (item.category)\n      feedItem.tags = item.category\n        .filter((category) => category.name)\n        .map((category) => category.name);\n\n    return feedItem;\n  });\n\n  return JSON.stringify(content, null, 2);\n};\n","import { encodeCDATA, encodeXML, isUrl, stripTags } from \"vuepress-shared/node\";\nimport { js2xml } from \"xml-js\";\nimport { FEED_GENERATOR } from \"../utils.js\";\n\nimport type {\n  RSSCategory,\n  RSSContent,\n  RSSEnclosure,\n  RSSGuid,\n  RSSItem,\n} from \"./typings.js\";\nimport type { Feed } from \"../feed.js\";\nimport type {\n  FeedCategory,\n  FeedEnclosure,\n  FeedItemOption,\n} from \"../typings/index.js\";\n\nconst genCategory = (category: FeedCategory): RSSCategory => {\n  const { name, domain } = category;\n\n  return {\n    _text: name,\n    ...(domain ? { _attributes: { domain } } : {}),\n  };\n};\n\nconst genGuid = (item: FeedItemOption): RSSGuid => {\n  const guid = item.guid || encodeXML(item.link);\n\n  return {\n    ...(isUrl(guid)\n      ? {}\n      : {\n          _attributes: {\n            isPermaLink: false,\n          },\n        }),\n    _text: guid,\n  };\n};\n\nconst genEnclosure = (enclosure: FeedEnclosure): RSSEnclosure => ({\n  _attributes: {\n    url: enclosure.url,\n    ...(enclosure.length ? { length: enclosure.length } : {}),\n    ...(enclosure.type ? { type: enclosure.type } : {}),\n  },\n});\n\n/**\n * Returns a RSS 2.0 feed\n *\n * @see https://validator.w3.org/feed/docs/rss2.html\n */\nexport const renderRSS = (feed: Feed): string => {\n  const { links, channel } = feed.options;\n  let hasContent = false;\n\n  const content: RSSContent = {\n    _declaration: { _attributes: { version: \"1.0\", encoding: \"utf-8\" } },\n    rss: {\n      _attributes: {\n        version: \"2.0\",\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"xmlns:atom\": \"http://www.w3.org/2005/Atom\",\n      },\n      channel: {\n        /**\n         * @see http://validator.w3.org/feed/docs/warning/MissingAtomSelfLink.html\n         */\n        // eslint-disable-next-line @typescript-eslint/naming-convention\n        \"atom:link\": {\n          _attributes: {\n            href: links.rss,\n            rel: \"self\",\n            type: \"application/rss+xml\",\n          },\n        },\n        title: { _text: channel.title },\n        link: { _text: encodeXML(channel.link) },\n        description: { _text: channel.description },\n        language: { _text: encodeXML(channel.language) },\n        pubDate: {\n          _text: channel.pubDate\n            ? channel.pubDate.toUTCString()\n            : new Date().toUTCString(),\n        },\n        lastBuildDate: {\n          _text: channel.lastUpdated\n            ? channel.lastUpdated.toUTCString()\n            : new Date().toUTCString(),\n        },\n        generator: { _text: FEED_GENERATOR },\n        docs: {\n          _text: \"https://validator.w3.org/feed/docs/rss2.html\",\n        },\n      },\n    },\n  };\n\n  if (channel.copyright)\n    content.rss.channel.copyright = { _text: channel.copyright };\n\n  if (channel.ttl) content.rss.channel.ttl = { _text: channel.ttl.toString() };\n\n  if (channel.image)\n    content.rss.channel.image = {\n      title: { _text: channel.title },\n      url: { _text: channel.image },\n      link: { _text: encodeXML(channel.link) },\n    };\n\n  /**\n   * Channel Categories\n   *\n   * @see https://validator.w3.org/feed/docs/rss2.html#comments\n   */\n  content.rss.channel.category = Array.from(feed.categories).map(\n    (category) => ({ _text: category })\n  );\n\n  /**\n   * Channel Categories\n   *\n   * @see https://validator.w3.org/feed/docs/rss2.html#hrelementsOfLtitemgt\n   */\n  content.rss.channel.item = feed.items.map((entry) => {\n    const item: RSSItem = {\n      title: { _text: encodeXML(entry.title) },\n      link: { _text: encodeXML(entry.link) },\n      guid: genGuid(entry),\n      source: {\n        _attributes: { url: links.rss },\n        _text: entry.title,\n      },\n    };\n\n    if (entry.description)\n      item.description = {\n        _text: entry.description.startsWith(\"html:\")\n          ? stripTags(entry.description.substring(5))\n          : entry.description,\n      };\n\n    /**\n     * Item Author\n     */\n    if (entry.author) {\n      const author = entry.author.find((author) => author.email && author.name);\n\n      if (author)\n        item.author = {\n          _text: `${author.email!} (${author.name!})`,\n        };\n    }\n\n    /**\n     * Item Category\n     *\n     * @see https://validator.w3.org/feed/docs/rss2.html#ltcategorygtSubelementOfLtitemgt\n     */\n    if (entry.category)\n      item.category = entry.category\n        .filter((category) => category.name)\n        .map((category) => genCategory(category));\n\n    if (entry.comments) item.comments = { _text: encodeXML(entry.link) };\n\n    if (entry.pubDate) item.pubDate = { _text: entry.pubDate.toUTCString() };\n\n    if (entry.content) {\n      hasContent = true;\n      item[\"content:encoded\"] = { _cdata: encodeCDATA(entry.content) };\n    }\n\n    /**\n     * Item Enclosure\n     *\n     * @see https://validator.w3.org/feed/docs/rss2.html#ltenclosuregtSubelementOfLtitemgt\n     */\n    if (entry.enclosure) item.enclosure = genEnclosure(entry.enclosure);\n\n    return item;\n  });\n\n  if (hasContent) {\n    content.rss._attributes[\"xmlns:content\"] =\n      \"http://purl.org/rss/1.0/modules/content/\";\n    content.rss._attributes[\"xmlns:dc\"] = \"http://purl.org/dc/elements/1.1/\";\n  }\n\n  return js2xml(content, {\n    compact: true,\n    ignoreComment: true,\n    spaces: 2,\n  });\n};\n","import { renderAtom } from \"./atom/index.js\";\nimport { renderJSON } from \"./json/index.js\";\nimport { renderRSS } from \"./rss/index.js\";\n\nimport type {\n  FeedContributor,\n  FeedInitOptions,\n  FeedItemOption,\n} from \"./typings/index.js\";\n\nexport class Feed {\n  items: FeedItemOption[] = [];\n\n  categories = new Set<string>();\n\n  private _contributorKeys = new Set<string>();\n\n  contributors: FeedContributor[] = [];\n\n  constructor(public options: FeedInitOptions) {}\n\n  /**\n   * Add a feed item\n   */\n  public addItem = (item: FeedItemOption): void => {\n    this.items.push(item);\n  };\n\n  /**\n   * Add a category\n   */\n  public addCategory = (category: string): void => {\n    this.categories.add(category);\n  };\n\n  /**\n   * Add a contributor\n   */\n  public addContributor = (contributor: FeedContributor): void => {\n    // use keys to avoid adding same contributor\n    const key = contributor.email || contributor.name;\n\n    if (key && !this._contributorKeys.has(key)) {\n      this._contributorKeys.add(key);\n      this.contributors.push(contributor);\n    }\n  };\n\n  /**\n   * Returns a Atom 1.0 feed\n   */\n  public atom = (): string => renderAtom(this);\n\n  /**\n   * Returns a RSS 2.0 feed\n   */\n  public rss = (): string => renderRSS(this);\n\n  /**\n   * Returns a JSON 1.1 feed\n   */\n  public json = (): string => renderJSON(this);\n}\n","import {\n  getAuthor,\n  getCategory,\n  getPageExcerpt,\n  getPageText,\n  isAbsoluteUrl,\n  isUrl,\n} from \"vuepress-shared/node\";\nimport { getImageMineType, resolveUrl } from \"./utils.js\";\n\nimport type { AuthorInfo } from \"vuepress-shared\";\nimport type { App, Page, PageFrontmatter } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport type { Feed } from \"./feed.js\";\nimport type {\n  FeedAuthor,\n  FeedCategory,\n  FeedContributor,\n  FeedEnclosure,\n  FeedGetter,\n  FeedItemOption,\n  FeedOptions,\n  FeedFrontmatterOption,\n  FeedPluginFrontmatter,\n} from \"./typings/index.js\";\n\nexport class FeedPage {\n  private pageFeedOptions: FeedFrontmatterOption;\n  private frontmatter: PageFrontmatter<FeedPluginFrontmatter>;\n  private base: string;\n  private getter: FeedGetter;\n\n  constructor(\n    private app: App,\n    private options: FeedOptions,\n    private page: Page<\n      { excerpt?: string; git?: GitData },\n      FeedPluginFrontmatter\n    >,\n    private feed: Feed\n  ) {\n    this.base = this.app.options.base;\n    this.frontmatter = page.frontmatter;\n    this.getter = options.getter || {};\n    this.pageFeedOptions = this.frontmatter.feed || {};\n  }\n\n  get title(): string {\n    if (typeof this.getter.title === \"function\")\n      return this.getter.title(this.page);\n\n    return this.pageFeedOptions.title || this.page.title;\n  }\n\n  /** real url */\n  get link(): string {\n    if (typeof this.getter.link === \"function\")\n      return this.getter.link(this.page);\n\n    return resolveUrl(this.options.hostname, this.base, this.page.path);\n  }\n\n  get description(): string | null {\n    if (typeof this.getter.description === \"function\")\n      return this.getter.description(this.page);\n\n    if (this.pageFeedOptions.description)\n      return this.pageFeedOptions.description;\n\n    if (this.frontmatter.description) return this.frontmatter.description;\n\n    const pageText = getPageText(this.page);\n\n    return pageText.length > 180 ? `${pageText.slice(0, 177)}...` : pageText;\n  }\n\n  get author(): FeedAuthor[] {\n    if (typeof this.getter.author === \"function\")\n      return this.getter.author(this.page);\n\n    if (Array.isArray(this.pageFeedOptions.author))\n      return this.pageFeedOptions.author;\n\n    if (typeof this.pageFeedOptions.author === \"object\")\n      return [this.pageFeedOptions.author];\n\n    return this.frontmatter.author === false\n      ? []\n      : this.frontmatter.author\n      ? getAuthor(this.frontmatter.author)\n      : this.options.channel?.author\n      ? getAuthor(<AuthorInfo>this.options.channel?.author)\n      : [];\n  }\n\n  get category(): FeedCategory[] | null {\n    if (typeof this.getter.category === \"function\")\n      return this.getter.category(this.page);\n\n    if (Array.isArray(this.pageFeedOptions.category))\n      return this.pageFeedOptions.category;\n\n    if (typeof this.pageFeedOptions.category === \"object\")\n      return [this.pageFeedOptions.category];\n\n    const { categories, category = categories } = this.frontmatter;\n\n    return getCategory(category).map((item) => ({ name: item }));\n  }\n\n  get enclosure(): FeedEnclosure | null {\n    if (typeof this.getter.enclosure === \"function\")\n      return this.getter.enclosure(this.page);\n\n    if (this.image)\n      return {\n        url: this.image,\n        type: getImageMineType(this.image.split(\".\").pop()),\n      };\n\n    return null;\n  }\n\n  get guid(): string {\n    return this.pageFeedOptions.guid || this.link;\n  }\n\n  get pubDate(): Date | null {\n    if (typeof this.getter.publishDate === \"function\")\n      return this.getter.publishDate(this.page);\n\n    const { time, date = time } = this.page.frontmatter;\n\n    const { createdTime } = this.page.data.git || {};\n\n    return date && date instanceof Date\n      ? date\n      : createdTime\n      ? new Date(createdTime)\n      : null;\n  }\n\n  get lastUpdated(): Date {\n    if (typeof this.getter.lastUpdateDate === \"function\")\n      return this.getter.lastUpdateDate(this.page);\n\n    const { updatedTime } = this.page.data.git || {};\n\n    return updatedTime ? new Date(updatedTime) : new Date();\n  }\n\n  get content(): string {\n    if (typeof this.getter.content === \"function\")\n      return this.getter.content(this.page);\n\n    if (this.pageFeedOptions.content) return this.pageFeedOptions.content;\n\n    return getPageExcerpt(this.app, this.page, { excerptLength: Infinity });\n  }\n\n  get image(): string | null {\n    if (typeof this.getter.image === \"function\")\n      return this.getter.image(this.page);\n\n    const { banner, cover } = this.frontmatter;\n\n    if (banner) {\n      if (isAbsoluteUrl(banner))\n        return resolveUrl(this.options.hostname, this.app.options.base, banner);\n\n      if (isUrl(banner)) return banner;\n    }\n\n    if (cover) {\n      if (isAbsoluteUrl(cover))\n        return resolveUrl(this.options.hostname, this.app.options.base, cover);\n\n      if (isUrl(cover)) return cover;\n    }\n\n    const result = /!\\[.*?\\]\\((.*?)\\)/iu.exec(this.page.content);\n\n    if (result) {\n      if (isAbsoluteUrl(result[1]))\n        return resolveUrl(\n          this.options.hostname,\n          this.app.options.base,\n          result[1]\n        );\n\n      if (isUrl(result[1])) return result[1];\n    }\n\n    return null;\n  }\n\n  get contributor(): FeedContributor[] {\n    if (typeof this.getter.contributor === \"function\")\n      return this.getter.contributor(this.page);\n\n    if (Array.isArray(this.pageFeedOptions.contributor))\n      return this.pageFeedOptions.contributor;\n\n    if (typeof this.pageFeedOptions.contributor === \"object\")\n      return [this.pageFeedOptions.contributor];\n\n    return this.author;\n  }\n\n  get copyright(): string | null {\n    if (typeof this.getter.copyright === \"function\")\n      return this.getter.copyright(this.page);\n\n    if (this.frontmatter.copyright) return this.frontmatter.copyright;\n    const firstAuthor = this.author[0];\n\n    if (firstAuthor?.name) return `Copyright by ${firstAuthor.name}`;\n\n    return null;\n  }\n\n  getFeedItem(): FeedItemOption | null {\n    const {\n      author,\n      category,\n      content,\n      contributor,\n      copyright,\n      description,\n      enclosure,\n      guid,\n      image,\n      lastUpdated,\n      link,\n      pubDate,\n      title,\n    } = this;\n\n    // we need at least title or description\n    if (!title && !description) return null;\n\n    // add category to feed\n    if (category) category.forEach((item) => this.feed.addCategory(item.name));\n\n    // add contributor to feed\n    if (contributor)\n      contributor.forEach((item) => this.feed.addContributor(item));\n\n    return {\n      title,\n      link,\n      guid,\n      lastUpdated,\n      content,\n      author,\n      contributor,\n      ...(description ? { description } : {}),\n      ...(category ? { category } : {}),\n      ...(enclosure ? { enclosure } : {}),\n      ...(pubDate ? { pubDate } : {}),\n      ...(image ? { image } : {}),\n      ...(copyright ? { copyright } : {}),\n    };\n  }\n}\n","import { colors, fs, path } from \"@vuepress/utils\";\n\nimport { Feed } from \"./feed.js\";\nimport { getFeedChannelOption, getFilename, getFeedLinks } from \"./options.js\";\nimport { FeedPage } from \"./page.js\";\nimport { compareDate, logger } from \"./utils.js\";\n\nimport type { App, Page } from \"@vuepress/core\";\nimport type { GitData } from \"@vuepress/plugin-git\";\nimport type { ResolvedFeedOptionsMap } from \"./options.js\";\nimport type { FeedPluginFrontmatter } from \"./typings/index.js\";\n\nexport class FeedGenerator {\n  /** feed 生成器 */\n  feedMap: Record<string, Feed>;\n\n  constructor(private app: App, private options: ResolvedFeedOptionsMap) {\n    this.feedMap = Object.fromEntries(\n      Object.entries(options).map(([localePath, localeOptions]) => {\n        return [\n          localePath,\n          new Feed({\n            channel: getFeedChannelOption(app, localeOptions, localePath),\n            links: getFeedLinks(app, localeOptions),\n          }),\n        ];\n      })\n    );\n  }\n\n  addPages(localePath: string): void {\n    const feed = this.feedMap[localePath];\n    const localeOption = this.options[localePath];\n    const {\n      count: feedCount = 100,\n      filter = ({ frontmatter, filePathRelative }: Page): boolean =>\n        !(\n          frontmatter[\"home\"] ||\n          !filePathRelative ||\n          frontmatter[\"article\"] === false ||\n          frontmatter[\"feed\"] === false\n        ),\n      sorter = (\n        pageA: Page<{ git?: GitData }, Record<string, never>>,\n        pageB: Page<{ git?: GitData }, Record<string, never>>\n      ): number =>\n        compareDate(\n          pageA.data.git?.createdTime\n            ? new Date(pageA.data.git?.createdTime)\n            : pageA.frontmatter.date,\n          pageB.data.git?.createdTime\n            ? new Date(pageB.data.git?.createdTime)\n            : pageB.frontmatter.date\n        ),\n    } = localeOption;\n    const pages = this.app.pages\n      .filter((page) => page.pathLocale === localePath)\n      .filter(filter)\n\n      // @ts-ignore\n      .sort(sorter)\n      .slice(0, feedCount);\n\n    let count = 0;\n\n    for (const page of pages) {\n      const item = new FeedPage(\n        this.app,\n        localeOption,\n        <Page<{ git?: GitData }, FeedPluginFrontmatter>>page,\n        feed\n      ).getFeedItem();\n\n      if (item) {\n        feed.addItem(item);\n        count += 1;\n      }\n    }\n\n    logger.succeed(\n      `added ${colors.cyan(\n        `${count} page${count > 1 ? \"s\" : \"\"}`\n      )} as feed item${count > 1 ? \"s\" : \"\"} in route ${colors.cyan(\n        localePath\n      )}`\n    );\n  }\n\n  async generateFeed(): Promise<void> {\n    const { dest } = this.app.dir;\n\n    await Promise.all(\n      Object.entries(this.options).map(async ([localePath, localeOptions]) => {\n        // current locale has valid output\n        if (localeOptions.atom || localeOptions.json || localeOptions.rss) {\n          const feed = this.feedMap[localePath];\n          const { atomOutputFilename, jsonOutputFilename, rssOutputFilename } =\n            getFilename(localeOptions, localePath);\n\n          this.addPages(localePath);\n\n          // generate atom files\n          if (localeOptions.atom) {\n            await fs.ensureDir(path.dirname(dest(atomOutputFilename)));\n            await fs.outputFile(dest(atomOutputFilename), feed.atom());\n\n            logger.succeed(\n              `Atom feed file generated and saved to ${colors.cyan(\n                `/${atomOutputFilename}`\n              )}`\n            );\n          }\n\n          // generate json files\n          if (localeOptions.json) {\n            await fs.ensureDir(path.dirname(dest(jsonOutputFilename)));\n            await fs.outputFile(dest(jsonOutputFilename), feed.json());\n\n            logger.succeed(\n              `JSON feed file generated and saved to ${colors.cyan(\n                `${jsonOutputFilename}`\n              )}`\n            );\n          }\n\n          // generate rss files\n          if (localeOptions.rss) {\n            await fs.ensureDir(path.dirname(dest(rssOutputFilename)));\n            await fs.outputFile(dest(rssOutputFilename), feed.rss());\n\n            logger.succeed(\n              `RSS feed file generated and saved to ${colors.cyan(\n                `${rssOutputFilename}`\n              )}`\n            );\n          }\n        }\n      })\n    );\n  }\n}\n","import { colors } from \"@vuepress/utils\";\nimport { convertOptions } from \"./compact/index.js\";\nimport { checkOutput, ensureHostName, getFeedOptions } from \"./options.js\";\nimport { injectLinksToHead } from \"./injectHead.js\";\nimport { FeedGenerator } from \"./generator.js\";\nimport { logger } from \"./utils.js\";\n\nimport type { PluginFunction, PluginObject } from \"@vuepress/core\";\nimport type { FeedOptions } from \"./typings/index.js\";\n\nexport const feedPlugin =\n  (options: FeedOptions, legacy = false): PluginFunction =>\n  (app) => {\n    // TODO: Remove this in v2 stable\n    if (legacy)\n      convertOptions(options as FeedOptions & Record<string, unknown>);\n    if (app.env.isDebug) logger.info(\"Options:\", options);\n\n    const plugin: PluginObject = {\n      name: \"vuepress-plugin-feed2\",\n    };\n\n    if (!ensureHostName(options)) {\n      logger.error(`Option ${colors.magenta(\"hostname\")} is required!`);\n\n      return plugin;\n    }\n\n    if (!checkOutput(options)) {\n      logger.info(\"No requested output, the plugin won’t start!\");\n\n      return plugin;\n    }\n\n    const feedOptions = getFeedOptions(app, options);\n\n    return {\n      ...plugin,\n\n      onPrepared: (app): void => injectLinksToHead(app, feedOptions),\n\n      onGenerated: async (app): Promise<void> => {\n        await new FeedGenerator(app, feedOptions).generateFeed();\n      },\n    };\n  };\n"],"names":["FEED_GENERATOR","logger","Logger","compareDate","dateA","dateB","resolveUrl","hostname","base","path","isLinkHttp","removeEndingSlash","removeLeadingSlash","getImageMineType","ext","droppedLogger","options","droppedOption","hint","newOption","colors","convertOptions","_a","_b","_c","_d","_e","_f","_g","_h","_i","_j","_k","_l","ensureHostName","checkOutput","atom","json","rss","getFeedOptions","siteData","localePath","frontmatter","filePathRelative","pageA","pageB","getFeedChannelOption","app","title","description","lang","locales","icon","image","author","defaultChannelOption","deepMerge","getFilename","prefix","getFeedLinks","atomOutputFilename","jsonOutputFilename","rssOutputFilename","injectLinksToHead","localePaths","getHeadItem","name","fileName","type","page","pathLocale","localeOptions","getAuthor","email","url","encodeXML","genCategory","category","scheme","renderAtom","feed","channel","links","content","contributor","item","entry","encodeCDATA","js2xml","formatAuthor","renderJSON","feedItem","stripTags","domain","genGuid","guid","isUrl","genEnclosure","enclosure","renderRSS","hasContent","Feed","key","FeedPage","pageText","getPageText","categories","getCategory","time","date","createdTime","updatedTime","getPageExcerpt","banner","cover","isAbsoluteUrl","result","firstAuthor","copyright","lastUpdated","link","pubDate","FeedGenerator","localeOption","feedCount","filter","sorter","pages","count","dest","fs","feedPlugin","legacy","plugin","feedOptions"],"mappings":"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"}