import{colors as S,fs as D}from"@vuepress/utils";import{Logger as J,isAbsoluteUrl as O,isUrl as y,getAuthor as k,getDate as _,stripTags as R,getPageText as F}from"vuepress-shared/node";import{isLinkHttp as M,removeEndingSlash as $,removeLeadingSlash as q}from"@vuepress/shared";const p=new J("vuepress-plugin-seo2"),E=(t,e)=>Object.entries(e).map(([a,o])=>({localePath:a,lang:o.lang})).filter(a=>typeof a.lang=="string"&&a.lang!==t),C=({frontmatter:t},{hostname:e},{options:{base:a}})=>{const{banner:o,cover:n}=t;if(o){if(O(o))return v(e,a,o);if(y(o))return o}if(n){if(O(n))return v(e,a,n);if(y(n))return n}return null},T=({content:t},{hostname:e},{options:{base:a}})=>{const o=/!\[.*?\]\((.*?)\)/giu.exec(t);return o?o.map(([,n])=>O(n)?v(e,a,n):y(n)?n:null).filter(n=>n!==null):[]},v=(t,e,a)=>`${M(t)?$(t):`https://${$(t)}`}${e}${q(a)}`,U=(t,e,a="",o="")=>{e in t&&(p.error(`"${S.magenta(e)}" is ${S.red("removed")}${o?`, please use ${S.magenta(o)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),o||delete t[e])},W=t=>{U(t,"seo","","ogp"),U(t,"customMeta","","customHead")},z=(t,e,a)=>{var o,n,i;const{isArticle:r=c=>Boolean(c.filePathRelative&&!c.frontmatter.home)}=e,{options:{base:d},siteData:s}=a,{frontmatter:{author:g,time:b,date:m=b,tag:u,tags:f=u},data:{git:h={}}}=t,l=((o=s.locales[t.pathLocale])==null?void 0:o.title)||s.title||((n=s.locales["/"])==null?void 0:n.title)||"",j=g===!1?[]:k(g||e.author),{updatedTime:x}=h,I=x?new Date(x).toISOString():"",B=Array.isArray(f)?f:typeof u=="string"?[u]:[],P=t.title,G=C(t,e,a),H=T(t,e,a),N=E(t.lang,s.locales);let w="";if(m instanceof Date)w=new Date(m).toISOString();else if(m){const c=_(m);c&&c.value&&(w=c.value.toISOString())}const A=G||H[0]||e.fallBackImage||"";return{"og:url":v(e.hostname,d,t.path),"og:site_name":l,"og:title":P,"og:description":t.frontmatter.description||"","og:type":r(t)?"article":"website","og:image":A,"og:updated_time":I,"og:locale":t.lang,"og:locale:alternate":N.map(({lang:c})=>c),...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},...A?{"twitter:card":"summary_large_image","twitter:image:alt":P}:{},"article:author":(i=j[0])==null?void 0:i.name,"article:tag":B,"article:published_time":w,"article:modified_time":I}},K=(t,e,a)=>{const{isArticle:o=l=>Boolean(l.filePathRelative&&!l.frontmatter.home)}=e,{frontmatter:{author:n,time:i,date:r=i},data:{git:d={}}}=t,s=n===!1?[]:k(n||e.author),{updatedTime:g}=d,b=g?new Date(g).toISOString():"",m=t.title,u=C(t,e,a),f=T(t,e,a);let h="";if(r instanceof Date)h=new Date(r).toISOString();else if(r){const l=_(r);l&&l.value&&(h=l.value.toISOString())}return o(t)?{"@context":"https://schema.org","@type":"NewsArticle",headline:m,image:f.length?f:[u||e.fallBackImage||""],datePublished:h,dateModified:b,author:s.map(l=>({"@type":"Person",...l}))}:null},Q=(t,e)=>typeof e.canonical=="function"?e.canonical(t):typeof e.canonical=="string"?`${$(e.canonical)}${t.path}`:null,V=(t,{hostname:e},{options:a,siteData:o})=>E(t.lang,o.locales).map(({lang:n,localePath:i})=>({lang:n,path:v(e,a.base,`${i}${t.path.replace(t.pathLocale,"")}`)})),L=(t,{name:e,content:a,attribute:o=["article:","og:"].some(n=>e.startsWith(n))?"property":"name"})=>{a&&t.push(["meta",{[o]:e,content:a}])},X=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(o=>L(t,{name:"article:tag",content:o}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(o=>{o!==e["og:locale"]&&L(t,{name:"og:locale:alternate",content:o})});break;default:e[a]&&L(t,{name:a,content:e[a]})}},Y=(t,e)=>{e&&t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},Z=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},tt=(t,e)=>{e.forEach(({lang:a,path:o})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:o}])})},et=(t,e,a)=>{const o=t.frontmatter.head||[],n=z(t,e,a),i=K(t,e,a),r=e.ogp?e.ogp(n,t,a):n,d=e.jsonLd?e.jsonLd(i,t,a):null,s=Q(t,e),g=V(t,e,a);X(o,r),Y(o,d),Z(o,s),tt(o,g),e.customHead&&e.customHead(o,t,a),t.frontmatter.head=o},at=async t=>{p.load("Generating robots.txt");const e=t.public("robots.txt");let a=D.existsSync(e)?await D.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(p.error(),p.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await D.writeFile(t.dest("robots.txt"),a,{flag:"w"}),p.succeed())},ot=(t,e=!1)=>a=>{e&&W(t),a.env.isDebug&&p.info("Options:",t);const o={name:"vuepress-plugin-seo2"};return t.hostname?{...o,extendsPage:(n,i)=>{if(!n.frontmatter.description&&t.autoDescription!==!1){if(n.data.excerpt)n.frontmatter.description=R(n.data.excerpt).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim();else{const r=F(n);n.frontmatter.description=r.length>180?`${r.slice(0,177)}...`:r}n.data.autoDesc=!0}et(n,t,i)},onGenerated:n=>at(n.dir)}:(p.error(`Option ${S.magenta("hostname")} is required!`),o)};export{ot as seoPlugin};
//# sourceMappingURL=index.js.map
